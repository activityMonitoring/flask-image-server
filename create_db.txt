drop schema public cascade;
create schema public;


CREATE TABLE Studies(
	study_id SERIAL PRIMARY KEY,
	name VARCHAR(256)
);

CREATE TABLE Participants(
	participant_id SERIAL PRIMARY KEY,
	name VARCHAR(50)
);

CREATE TABLE StudyParticipants( -- study -> participant linking table
	study_id INT REFERENCES Studies(study_id),
	participant_id INT REFERENCES Participants(participant_id),
	CONSTRAINT unique_links UNIQUE (study_id, participant_id)
);

CREATE TABLE Users(
	user_id SERIAL PRIMARY KEY,
	username VARCHAR(50),
	password VARCHAR(50)
);

CREATE TABLE UserAccess(
	user_id INT REFERENCES Users(user_id),
	study_id INT REFERENCES Studies(study_id),
	access_level INT NOT NULL -- e.g. 0 none, 1 read, 2 write, 3 admin
);

CREATE TABLE Images(
	image_id SERIAL PRIMARY KEY,
	image_time TIMESTAMP,
	participant_id INT REFERENCES Participants(participant_id),
	full_url VARCHAR(256), -- if null means not uploaded/processed
	medium_url VARCHAR(256), 
	thumbnail_url VARCHAR(256)
);

CREATE TABLE Events(
	event_id SERIAL PRIMARY KEY,
	participant_id INT REFERENCES Participants(participant_id),
	day DATE NOT NULL,
	start_time TIMESTAMP NOT NULL,
	end_time TIMESTAMP NOT NULL,
	comment TEXT,
	number_times_viewed INT
);

INSERT INTO Users(username,password) VALUES('Aiden', 'Aiden');
INSERT INTO Users(username,password) VALUES('Sven', 'Sven');
INSERT INTO Users(username,password) VALUES('Guest', '');
INSERT INTO Studies(name) VALUES('US election');
INSERT INTO Studies(name) VALUES('Study of Dave');
INSERT INTO Studies(name) VALUES('Capture24');
INSERT INTO Studies(name) VALUES('Automatically Added');
INSERT INTO UserAccess(user_id,study_id,access_level) VALUES(1,1,2);
INSERT INTO UserAccess(user_id,study_id,access_level) VALUES(2,2,2);
INSERT INTO UserAccess(user_id,study_id,access_level) VALUES(1,2,2);
INSERT INTO Participants(name) VALUES('Joe Biden');
INSERT INTO Participants(name) VALUES('Hillary Clinton');
INSERT INTO Participants(name) VALUES('Bernie Sanders');
INSERT INTO Participants(name) VALUES('Dave');
INSERT INTO Participants(name) VALUES('Dave2');
INSERT INTO StudyParticipants(study_id, participant_id) VALUES(1,1);
INSERT INTO StudyParticipants(study_id, participant_id) VALUES(1,2);
INSERT INTO StudyParticipants(study_id, participant_id) VALUES(1,3);
INSERT INTO StudyParticipants(study_id, participant_id) VALUES(2,4);
INSERT INTO StudyParticipants(study_id, participant_id) VALUES(2,5);
