{% extends "layout.html" %}

{% set im_width=100 %}
{% set im_padding=10 %}
{% set im_both=im_width+im_padding %}
{% set im_half=im_both/2 %}

{% block title %}
	Participant
{% endblock %}
{% block style %}
	.img {
		margin: 0px;
		float: left;
		width: {{im_both}}px;
		height: 190px;
		text-align:center
	}
	.img :after {
		content: '';
	    display: block;
	    clear: both;
	}
	.shadow-wrapper:after {
	    clear:both;
	    content:" ";
	    display:block;
	}
{% endblock %}
{% block content %}
	<h2> Participant: {{name}} (showing {{images | length}} images out of {{num_images}})</h2>
	{% if event_id %}
		<h3> Event ID: {{event_id}} <h3>
		{% if event_seconds %}
			<h3> Length: {{event_seconds | verbose_seconds}}</h3>
		{% endif%}
		<button onclick="Event.check_valid({{event_id}}, {{id}}, function() {$('#valid_result').html('valid')})">Check valid</button><p id="valid_result"></p>
	{% endif%}
	<p> date range : {{daterange.min}} - {{daterange.max}}
	{% for day in days %}
		<h3> {{day}} </h3>
		{% for hour in days[day] %}

			<a href="/participant/{{id}}?date_min={{day}}T{{hour}}:00:00&date_max={{day}}T{{hour+1}}:00:00">
				<p>{{day}} {{hour}}:00 - {{days[day][hour]}} images</p> 
			</a>
		{% endfor %}
	{% endfor %}

	<div style=" padding-left:30px; padding-right:30px;" class="shadow-wrapper">
		<div style="text-align:left;float:left;margin:5px;">
			{% if prev_event_id %} 
				<a style="float:left;clear:left;" href="/participant/{{id}}/{{prev_event_id}}">prev event</a>
			{% endif %}
			{% if prev_image %} 
			<a style="float:left;clear:left;" href="{{prev_image.full_url}}"><img width="100" height="74" src='{{prev_image.thumbnail_url}}' ></a>
			<form action='/participant/{{id}}/{{event_id}}/add_prev_image' method='POST'> 
				<input type='submit' value='Add prev image'>
			</form> 
			{% endif %}
		</div> 
		<div style="text-align:right;float:right;margin:5px;">
			{% if next_event_id %}  
				<a style="float:left;clear:left;" href="/participant/{{id}}/{{next_event_id}}">next event</a>
			{% endif %}
			{% if next_image %} 
			<a style="float:left;clear:left;" href="{{next_image.full_url}}"><img width="100" height="74" src='{{next_image.thumbnail_url}}' ></a>
			<form action='/participant/{{id}}/{{event_id}}/add_next_image' method='POST'> 
				<input type='submit' value='Add next image'>
			</form> 
			{% endif %}
		</div> 
	</div>
	<div style="width:100%;padding:30px;" class="shadow-wrapper">

	{% set fillcol="lightblue" %}
	{% for image in images %}
		 <div class="img" id="{{image.image_id}}">
	 		<svg width="{{im_both}}" height="30">
	 			{% if image.event is not none %}			 	
				 	{% if not (image.is_last and image.is_first) %}
					 	{% if image.is_last %}
					 		<rect width="{{im_half}}" height="5" x="0" y="12.5" fill="{{fillcol}}" /> 
					 	{% elif image.is_first %}
					 		<rect width="{{im_half}}" height="5" x="{{im_half}}" y="12.5" fill="{{fillcol}}" /> 
					 	{% else %}
					 		<rect width="{{im_both}}" height="5" x="0" y="12.5" fill="{{fillcol}}" /> 
					 	{% endif %} 
				 	{% endif %} 
				 	{% if image.is_last or image.is_first %}
				 		<circle cx="{{im_half}}" cy="15" r="10" stroke="{{fillcol}}" stroke-width="5" fill="white" />
					{% endif %}
				{% endif %}
			</svg>
		 	<a href='{{image.full_url}}'><img width="{{im_width}}" height="74" src='{{image.thumbnail_url}}' ></a>
		 	 <a id="{{image.image_time}}" href="{% if image.event_id %}/participant/{{id}}/{{image.event_id}}{% endif %}">{{image.event_id}} - {{image.image_id}}</a> <p>{{ '%02d:%02d:%02d' % (image.image_time.hour, image.image_time.minute, image.image_time.second) }}</p> 
		 </div>
	{% else %}
		<p>No images</p>
	{% endfor %}
	</div>
{% endblock %}
